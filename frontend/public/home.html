<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบฝาก – ถอนเงินสหกรณ์ออมทรัพย์หมู่บ้าน ตําบล ตะกุกเหนือ</title>
    <link rel="icon" type="image/x-icon" href="/images/logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1B8F4C', // สีเขียวสดที่โดดเด่น
                        secondary: '#264C3B', // สีเขียวเข้มที่ให้ความรู้สึกมั่นคง
                        accent: '#D9D92E', // สีเหลืองทองที่โดดเด่น
                        background: '#F1F8F4', // พื้นหลังสีเขียวอ่อน
                        foreground: '#FFFFFF' // สีขาวสำหรับองค์ประกอบ
                    },
                    fontFamily: {
                        sans: ['IBM Plex Sans Thai', 'sans-serif'], // ฟอนต์ที่อ่านง่าย
                        heading: ['Poppins', 'sans-serif'] // ฟอนต์สำหรับหัวข้อ
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-image: url('https://images.unsplash.com/photo-1579621970563-ebec7560ff3e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1742&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        .stat-card {
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body class="min-h-screen">
    <div class="container mx-auto px-4 py-12">
        <!-- Header Section -->
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold text-white mb-4 drop-shadow-lg">ระบบฝาก – ถอนเงินสหกรณ์ออมทรัพย์หมู่บ้าน</h1>
            <h2 class="text-3xl font-bold text-white mb-6 drop-shadow-lg">ตําบล ตะกุกเหนือ</h2>
            <p class="text-xl text-white mb-8 max-w-2xl mx-auto drop-shadow-md">
                จัดการระบบฝาก ถอน กู้ยืมเงินได้อย่างมีประสิทธิภาพ ด้วยระบบที่ทันสมัยและปลอดภัย
            </p>
        </header>

        <!-- Login Section -->
        <div class="flex flex-col md:flex-row gap-8 mb-16">
            <!-- Login Form -->
            <div class="w-full md:w-1/3 glass-card rounded-2xl p-8">
                <h3 class="text-2xl font-bold text-white mb-6">เข้าสู่ระบบ</h3>
                <form id="loginForm" class="space-y-6">
                    <div>
                        <label for="email" class="block text-white mb-2">อีเมล</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                                <i class="fas fa-envelope text-gray-400"></i>
                            </span>
                            <input type="email" id="email" placeholder="กรอกอีเมลของคุณ" 
                                class="w-full pl-10 px-4 py-3 bg-white/30 border border-white/20 text-white rounded-lg outline-none focus:ring-2 focus:ring-green-300 placeholder-white/70" />
                        </div>
                    </div>
                    <div>
                        <label for="password" class="block text-white mb-2">รหัสผ่าน</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                                <i class="fas fa-lock text-gray-400"></i>
                            </span>
                            <input type="password" id="password" placeholder="กรอกรหัสผ่านของคุณ" 
                                class="w-full pl-10 px-4 py-3 bg-white/30 border border-white/20 text-white rounded-lg outline-none focus:ring-2 focus:ring-green-300 placeholder-white/70" />
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-300 flex items-center justify-center">
                        <i class="fas fa-sign-in-alt mr-2"></i> เข้าสู่ระบบ
                    </button>
                </form>
            </div>

            <!-- Financial Summary -->
            <div class="w-full md:w-2/3 glass-card rounded-2xl p-8">
                <h3 class="text-2xl font-bold text-white mb-6">ภาพรวมทางการเงิน</h3>
                
                <!-- Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="stat-card bg-white/20 rounded-lg p-4 border border-white/30">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-primary bg-opacity-30">
                                <i class="fas fa-users text-white text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <h4 class="text-sm font-medium text-white/80">จำนวนสมาชิก</h4>
                                <p class="text-2xl font-semibold text-white" id="totalMembers">120</p>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card bg-white/20 rounded-lg p-4 border border-white/30">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-blue-500 bg-opacity-30">
                                <i class="fas fa-piggy-bank text-white text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <h4 class="text-sm font-medium text-white/80">เงินฝากรวม</h4>
                                <p class="text-2xl font-semibold text-white" id="totalDeposits">฿3,250,000</p>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card bg-white/20 rounded-lg p-4 border border-white/30">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-purple-500 bg-opacity-30">
                                <i class="fas fa-hand-holding-usd text-white text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <h4 class="text-sm font-medium text-white/80">ยอดกู้รวม</h4>
                                <p class="text-2xl font-semibold text-white" id="totalLoans">฿1,750,000</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Charts -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white/20 rounded-lg p-4 border border-white/30">
                        <h4 class="text-lg font-semibold text-white mb-3">เงินฝากรายเดือน</h4>
                        <div class="h-60">
                            <canvas id="monthlySavingsChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white/20 rounded-lg p-4 border border-white/30">
                        <h4 class="text-lg font-semibold text-white mb-3">สัดส่วนประเภทธุรกรรม</h4>
                        <div class="h-60">
                            <canvas id="transactionTypeChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Features Section -->
        <div class="glass-card rounded-2xl p-8 mb-16">
            <h3 class="text-2xl font-bold text-white mb-6 text-center">บริการของเรา</h3>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="bg-white/20 rounded-lg p-6 border border-white/30 text-center">
                    <div class="bg-primary/30 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-money-bill-wave text-white text-2xl"></i>
                    </div>
                    <h4 class="text-xl font-semibold text-white mb-2">ฝาก-ถอนเงิน</h4>
                    <p class="text-white/80">บริการฝากและถอนเงินที่สะดวก รวดเร็ว และปลอดภัย</p>
                </div>
                <div class="bg-white/20 rounded-lg p-6 border border-white/30 text-center">
                    <div class="bg-blue-500/30 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-hand-holding-usd text-white text-2xl"></i>
                    </div>
                    <h4 class="text-xl font-semibold text-white mb-2">สินเชื่อ</h4>
                    <p class="text-white/80">บริการสินเชื่อดอกเบี้ยต่ำ เงื่อนไขยืดหยุ่น ผ่อนชำระสบาย</p>
                </div>
                <div class="bg-white/20 rounded-lg p-6 border border-white/30 text-center">
                    <div class="bg-purple-500/30 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-chart-line text-white text-2xl"></i>
                    </div>
                    <h4 class="text-xl font-semibold text-white mb-2">ปันผล</h4>
                    <p class="text-white/80">รับผลตอบแทนจากการออมในรูปแบบของเงินปันผลประจำปี</p>
                </div>
                <div class="bg-white/20 rounded-lg p-6 border border-white/30 text-center">
                    <div class="bg-yellow-500/30 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-file-invoice text-white text-2xl"></i>
                    </div>
                    <h4 class="text-xl font-semibold text-white mb-2">รายงาน</h4>
                    <p class="text-white/80">ตรวจสอบรายงานธุรกรรมและสถานะทางการเงินได้ตลอดเวลา</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center text-white/80">
            <p>© 2023 สหกรณ์ออมทรัพย์หมู่บ้าน ตําบล ตะกุกเหนือ. สงวนลิขสิทธิ์.</p>
            <div class="mt-4 flex justify-center space-x-4">
                <a href="#" class="text-white hover:text-accent transition"><i class="fab fa-facebook-f"></i></a>
                <a href="#" class="text-white hover:text-accent transition"><i class="fab fa-line"></i></a>
                <a href="#" class="text-white hover:text-accent transition"><i class="fas fa-envelope"></i></a>
                <a href="#" class="text-white hover:text-accent transition"><i class="fas fa-phone"></i></a>
            </div>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize charts and fetch real data
            fetchFinancialData();
            
            // Handle login form
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const email = document.getElementById('email').value;
                    const password = document.getElementById('password').value;
                    
                    // Simple validation
                    if (!email || !password) {
                        Swal.fire({
                            icon: 'error',
                            title: 'กรุณากรอกข้อมูลให้ครบถ้วน',
                            text: 'โปรดกรอกอีเมลและรหัสผ่านของคุณ',
                            confirmButtonColor: '#1B8F4C'
                        });
                        return;
                    }
                    
                    // Simulate login (replace with actual API call)
                    loginUser(email, password);
                });
            }
        });
        
        const loginUser = async (email, password) => {
            try {
                // Simulate API call
                // In production, replace with actual API call
                setTimeout(() => {
                    // Redirect based on user role (for demo)
                    if (email.includes('admin')) {
                        window.location.href = '/admin/dashboard.html';
                    } else if (email.includes('director')) {
                        window.location.href = '/director/reports.html';
                    } else if (email.includes('staff')) {
                        window.location.href = '/staff/dashboard.html';
                    } else {
                        window.location.href = '/member/dashboard.html';
                    }
                }, 1000);
                
                Swal.fire({
                    icon: 'info',
                    title: 'กำลังเข้าสู่ระบบ',
                    text: 'กรุณารอสักครู่...',
                    showConfirmButton: false,
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'เข้าสู่ระบบไม่สำเร็จ',
                    text: 'อีเมลหรือรหัสผ่านไม่ถูกต้อง',
                    confirmButtonColor: '#1B8F4C'
                });
            }
        };
        
        // ฟังก์ชันดึงข้อมูลจริงจาก API
        const fetchFinancialData = async () => {
            try {
                // แสดง loading state
                document.getElementById('totalMembers').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                document.getElementById('totalDeposits').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                document.getElementById('totalLoans').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                
                // ดึงข้อมูลจาก API - แก้ไข URL ให้ถูกต้อง
                const response = await fetch('/api/public/financial-summary');
                
                // ถ้าไม่สามารถเชื่อมต่อกับ API ได้ ให้ใช้ข้อมูลจำลอง
                if (!response.ok) {
                    console.warn('ไม่สามารถเชื่อมต่อกับ API ได้ ใช้ข้อมูลจำลองแทน');
                    useMockData();
                    return;
                }
                
                const data = await response.json();
                
                // อัพเดทข้อมูลในหน้าเว็บ
                updateSummaryCards(data);
                renderMonthlySavingsChart(data);
                renderTransactionTypeChart(data);
                
            } catch (error) {
                console.error('เกิดข้อผิดพลาดในการดึงข้อมูล:', error);
                // ใช้ข้อมูลจำลองในกรณีที่เกิดข้อผิดพลาด
                useMockData();
            }
        };
        
        // ฟังก์ชันอัพเดทข้อมูลในการ์ดสรุป
        const updateSummaryCards = (data) => {
            // อัพเดทจำนวนสมาชิก
            document.getElementById('totalMembers').textContent = (data.savingMembers || data.totalMembers || 0).toLocaleString();
            
            // อัพเดทยอดเงินฝากรวม
            document.getElementById('totalDeposits').textContent = '฿' + (data.totalDeposits || 0).toLocaleString();
            
            // อัพเดทยอดกู้รวม
            document.getElementById('totalLoans').textContent = '฿' + (data.totalLoans || 0).toLocaleString();
        };
        
        // ฟังก์ชันสร้างกราฟเงินฝากรายเดือน
        const renderMonthlySavingsChart = (data) => {
            const ctx = document.getElementById('monthlySavingsChart').getContext('2d');
            
            // ถ้ามีกราฟเดิมอยู่แล้ว ให้ทำลายก่อน
            if (window.savingsChart) {
                window.savingsChart.destroy();
            }
            
            window.savingsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.monthlySavings.map(item => item.month),
                    datasets: [{
                        label: 'ยอดเงินรายเดือน (บาท)',
                        data: data.monthlySavings.map(item => item.amount),
                        backgroundColor: 'rgba(27, 143, 76, 0.6)',
                        borderColor: 'rgba(27, 143, 76, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.8)',
                                callback: function(value) {
                                    return '฿' + value.toLocaleString();
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.8)'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        };
        
        // ฟังก์ชันสร้างกราฟสัดส่วนประเภทธุรกรรม
        const renderTransactionTypeChart = (data) => {
            const ctx = document.getElementById('transactionTypeChart').getContext('2d');
            
            // ถ้ามีกราฟเดิมอยู่แล้ว ให้ทำลายก่อน
            if (window.transactionChart) {
                window.transactionChart.destroy();
            }
            
            // กำหนดสีตามประเภทธุรกรรม
            const getTransactionColor = (type) => {
                switch (type.toLowerCase()) {
                    case 'deposit':
                    case 'ฝากเงิน':
                        return ['rgba(27, 143, 76, 0.7)', 'rgba(27, 143, 76, 1)']; // สีเขียว
                    case 'withdraw':
                    case 'ถอนเงิน':
                        return ['rgba(220, 38, 38, 0.7)', 'rgba(220, 38, 38, 1)']; // สีแดง
                    case 'loan':
                    case 'กู้ยืม':
                        return ['rgba(99, 102, 241, 0.7)', 'rgba(99, 102, 241, 1)']; // สีม่วง-น้ำเงิน
                    case 'payment':
                    case 'ชำระหนี้':
                        return ['rgba(245, 158, 11, 0.7)', 'rgba(245, 158, 11, 1)']; // สีส้ม
                    default:
                        return ['rgba(27, 143, 76, 0.7)', 'rgba(27, 143, 76, 1)']; // สีเขียวเป็นค่าเริ่มต้น
                }
            };
            
            window.transactionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.transactionTypes.map(item => item.type),
                    datasets: [{
                        data: data.transactionTypes.map(item => item.count),
                        backgroundColor: data.transactionTypes.map(item => getTransactionColor(item.type)[0]),
                        borderColor: data.transactionTypes.map(item => getTransactionColor(item.type)[1]),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: 'rgba(255, 255, 255, 0.8)',
                                font: {
                                    family: 'IBM Plex Sans Thai'
                                }
                            }
                        }
                    },
                    cutout: '60%'
                }
            });
        };
        
        // ฟังก์ชันใช้ข้อมูลจำลองในกรณีที่ไม่สามารถเชื่อมต่อกับ API ได้
        const useMockData = () => {
            // ข้อมูลจำลอง
            const mockData = {
                // ข้อมูลสมาชิก
                savingMembers: 120,
                loanMembers: 45,
                
                // ข้อมูลการเงิน
                totalDeposits: 3250000,
                totalLoans: 1750000,
                loanIncome: 125000,
                
                // ข้อมูลธุรกรรม
                transactionCount: 350,
                
                // ข้อมูลกราฟ
                monthlySavings: [
                    { month: 'ม.ค.', amount: 120000 },
                    { month: 'ก.พ.', amount: 150000 },
                    { month: 'มี.ค.', amount: 180000 },
                    { month: 'เม.ย.', amount: 210000 },
                    { month: 'พ.ค.', amount: 250000 },
                    { month: 'มิ.ย.', amount: 300000 }
                ],
                monthlyLoans: [
                    { month: 'ม.ค.', amount: 80000 },
                    { month: 'ก.พ.', amount: 95000 },
                    { month: 'มี.ค.', amount: 110000 },
                    { month: 'เม.ย.', amount: 130000 },
                    { month: 'พ.ค.', amount: 150000 },
                    { month: 'มิ.ย.', amount: 180000 }
                ],
                transactionTypes: [
                    {
                        type: 'เงินฝาก',
                        count: 45,
                        amount: 1500000,
                        color: '#1B8F4C',
                        bgColor: '#E3F5E9',
                        icon: 'fa-arrow-circle-down'
                    },
                    {
                        type: 'ถอนเงิน',
                        count: 25,
                        amount: 800000,
                        color: '#DC2626',
                        bgColor: '#FEE2E2',
                        icon: 'fa-arrow-circle-up'
                    },
                    {
                        type: 'การกู้ยืม',
                        count: 15,
                        amount: 1750000,
                        color: '#6366F1',
                        bgColor: '#EFF6FF',
                        icon: 'fa-hand-holding-usd'
                    },
                    {
                        type: 'ชำระเงินกู้',
                        count: 15,
                        amount: 450000,
                        color: '#F59E0B',
                        bgColor: '#FEF3C7',
                        icon: 'fa-money-bill-wave'
                    }
                ],
                memberGrowth: [
                    { month: 'ม.ค.', savingMembers: 80, loanMembers: 25 },
                    { month: 'ก.พ.', savingMembers: 85, loanMembers: 28 },
                    { month: 'มี.ค.', savingMembers: 90, loanMembers: 32 },
                    { month: 'เม.ย.', savingMembers: 95, loanMembers: 35 },
                    { month: 'พ.ค.', savingMembers: 105, loanMembers: 40 },
                    { month: 'มิ.ย.', savingMembers: 120, loanMembers: 45 }
                ]
            };
            
            // อัพเดทข้อมูลในหน้าเว็บ
            updateSummaryCards(mockData);
            renderMonthlySavingsChart(mockData);
            renderTransactionTypeChart(mockData);
        };
    </script>
    <script src="/admin/scripts/main.js"></script>
</body>
</html>
